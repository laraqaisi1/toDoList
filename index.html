<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <title>ToDoList</title>
</head>

<body>


  <div>


    <!-- Center The Table-->
    <div class="center">
      <!-- Table -->
      <div class="table">
        <!-- Header -->
        <div class="header">
          <h1>To Do List</h1>
          <button class="circular" id="add"><span class="material-symbols-outlined">
              add </span></button>
        </div>
        <!-- End Header -->

        <!-- TASKS SECTION -->
        <div id="tasks">

          <div class="task">
            <!-- WRITE TASK -->
            <div class="content">
              <h2>Read a book</h2>
              <div class="date">
                <span class="material-symbols-outlined">
                  calendar_month
                </span>
                6/5/2002
              </div>
            </div>
            <!-- END WRITE TASK -->

            <!-- TASK ICONS -->
            <span id="icons">
              <button class="circular"><span class="material-symbols-outlined">
                  delete
                </span></button>
              <button class="circular"><span class="material-symbols-outlined">
                  check
                </span></button>
              <button class="circular"><span class="material-symbols-outlined">
                  edit
                </span></button>
            </span>
            <!-- END TASK ICON -->
          </div>



        </div>

        <!-- END TASKS SECTION -->

      </div>
      <!-- Table -->
    </div>
    <!-- End Center The Table-->

  </div>


</body>


<script>

  var tasks = [
    {
      "title": "Read a book",
      "date": "6/5/2002",
      "isDone": true,
    },
    {
      "title": "play tennis",
      "date": "2/6/2002",
      "isDone": false,
    },
  ]


  function getTasksFromStorage() {
    tasks = retrivedTasks = JSON.parse(localStorage.getItem("tasks"));

    tasks = retrivedTasks ?? [];
  }


  getTasksFromStorage();

  InsertTasks();


  function InsertTasks() {
    document.getElementById('tasks').innerHTML = "";
    let index = 0;
    for (task of tasks) {
      let content = ` <div class="task  ${task.isDone ? 'done' : ''}">
            <!-- WRITE TASK -->
            <div class="content">
              <h2>${task.title}</h2>
              <div class="date">
                <span class="material-symbols-outlined">
                  calendar_month
                </span>
                ${task.date}
              </div>
            </div>
            <!-- END WRITE TASK -->

            <!-- TASK ICONS -->
            <span id="icons">
              <button class="circular" onclick="deleteTask(${index})"><span class="material-symbols-outlined">
                  delete
                </span></button>

                ${task.isDone ?
          `<button class="circular" onclick="ToggleCompleteTask(${index})" style="background-color:red; color:white  transtion:0.3s;"><span class="material-symbols-outlined">
                  close
                </span></button>`
          :
          ` <button class="circular" onclick="ToggleCompleteTask(${index})"><span class="material-symbols-outlined">
                  check
                </span></button>`
        }
             
              <button class="circular" onclick="editTask(${index})"><span class="material-symbols-outlined">
                  edit
                </span></button>
            </span>
            <!-- END TASK ICON -->
          </div>
`;

      document.getElementById('tasks').innerHTML += content;
      index++;
    };


  }


  document.getElementById('add').addEventListener("click", function () {
    let titleTask = prompt("Please enetr the title of the task");

    let dates = new Date();
    let time = dates.getDate() + "/" + (dates.getMonth() + 1) + "/" + dates.getFullYear() + "/" + dates.getHours() + ":" + dates.getMinutes();

    if (typeof titleTask == "string") {
      let task = {
        "title": titleTask,
        "date": time,
        "isDone": false,
      };

      tasks.push(task);
    };
    storeTasks();
    InsertTasks();
  });

  function editTask(index) {
    let task = tasks[index];
    let newTask = prompt("Please enetr the new task", task.title);


    let dates = new Date();
    let time = dates.getDate() + "/" + (dates.getMonth() + 1) + "/" + dates.getFullYear() + "/" + dates.getHours() + ":" + dates.getMinutes();


    if (typeof newTask == "string") {

      task.title = newTask;
      task.date = time;
      storeTasks();
      InsertTasks();

    }



  }


  function deleteTask(index) {
    let task = tasks[index]
    let isOk = confirm(`Are you sure you want to delete the task (${task.title}?)`)

    if (isOk) {
      tasks.splice(index, 1);
      storeTasks();
      InsertTasks();
    }


  }


  function ToggleCompleteTask(index) {

    let task = tasks[index];
    task.isDone = !task.isDone;
    storeTasks();
    InsertTasks();


  }

  function storeTasks() {
    let tasksString = JSON.stringify(tasks);
    localStorage.setItem("tasks", tasksString);
  }


</script>

</html>